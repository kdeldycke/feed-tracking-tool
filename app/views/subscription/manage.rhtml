<h2>Gestion des abonnements aux suivis</h2><br>

<%= error_messages_for 'subscription' %>

<% form_for :subscription do |f| %>		<!-- Formulaire de remplissage de l'entr�e cr��e dans la table subscription -->
<p>
  Suivi:
  <%= collection_select(:tracker, :id, @trackers, :id, :title) %>	<!-- Liste d�roulante contenant les suivis existant -->
</p>
<p>
  Fr&eacute;quence de r&eacute;ception (en jours):
  <%= f.text_field :frequency %>					<!-- Saisie de la fr�quence de r�ception du suivi -->
</p>
  <%= submit_tag 'Ajouter'%>
</p>
<% end %>

<p><h4>Vos suivis en cours</h4></p>

<table style="margin-bottom: 2em; margin-left: 2em; width: 95%" border="1">

	<tr>
	  <th>Titre du suivi</th>
	  <th>Flux RSS</th>
	  <th>XML</th>
	  <th>Fr&eacute;quence (j)</th>
	  <th>Annuler</th>

	<% Subscription.find(:all, :conditions => [ "user_id = ?", session[:user][:id] ]).each do |j| -%>	<!-- Pour chaque entr�e de la table subscription dont le champ user_id correspond � l'utilisateur courant -->
	    <tr>
	    	<td><%= Tracker.find_by_id(j.tracker_id).title %></td>		<!-- Affiche le titre du suivi en cours -->
			<td><%= link_to Rssfeed.find_by_id(Tracker.find_by_id(j.tracker_id).rssfeed_id).title, Rssfeed.find_by_id(Tracker.find_by_id(j.tracker_id).rssfeed_id).link %></td>	<!-- Affiche le titre du flux RSS associ� -->
			<td align="center"><%= link_to_image 'rss.gif', Rssfeed.find_by_id(Tracker.find_by_id(j.tracker_id).rssfeed_id).url %></td>
			<td align="center"><%= j.frequency %></td>				<!-- Affiche la fr�quence de r�ception -->
			<td align="center"><%= link_to 'Annuler', url_for(:action => 'destroy', :id => j.id) %></td>	<!-- Annuler l'abonnement (lien sur l'action destroy) -->
	    </tr>
	<% end -%>

</table>